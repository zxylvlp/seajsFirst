module.exports = function(grunt) {
  "use strict";     
  grunt.initConfig({
    less: {
      application: {
        options: {
          cleancss: true,
        },
        files: {
          'dist/styles/common.css': 'assets/styles/common.less',
        }
      },
      debug: {
        files: {
          'dist/styles/common-debug.css': 'assets/styles/common.less',
        }
      }
    },
              
    transport :  {
      options: {
        paths: ['dist/scripts'],
        alias: {
          "jquery": "libs/jquery/jquery"
        }
      },
      application :  {
        files :  [{
          cwd: 'assets/scripts',
          src: '**/*.js',
          expand: true,
          dest :  '.build/scripts'    //将application.js、util.js合并且提取依赖，生成id，之后放在.build目录下
                              
        }]

                       
      }          
    },
    concat :  {               
      application :  {                    
        files :  {
          'dist/scripts/application.js': ['.build/**/*.js',
            '!.build/**/*-debug.js'
          ],
          'dist/scripts/application-debug.js': ['.build/**/*-debug.js']                    
        }               
      }          
    },
    uglify :  {               
      application :  {                    
        files :  {                       
          'dist/scripts/application.js' :  ['dist/scripts/application.js']                    
        }               
      }          
    },
    clean :  {               
      application :  ['.build']  //清除.build文件
                
    },
    connect: {
      application: {
        options: {
          port: 4000
        }
      }
    },

    jshint: {
      application: {
        src: ['Gruntfile.js', 'assets/scripts/**/*.js'],
        options: {
          globals: {
            jQuery: true,
            console: true,
            module: true
          }
        }
      }

    },

    watch: {
      application: {
        files: ['Gruntfile.js', 'assets/scripts/**/*.js'],
        tasks: ['jshint']
      }
    },
        
  });
  grunt.loadNpmTasks('grunt-contrib-less');
  grunt.loadNpmTasks('grunt-cmd-transport');
  grunt.loadNpmTasks('grunt-cmd-concat');
  grunt.loadNpmTasks('grunt-contrib-uglify');
  grunt.loadNpmTasks('grunt-contrib-clean');
  grunt.loadNpmTasks('grunt-contrib-jshint');
  grunt.loadNpmTasks('grunt-contrib-connect');
  grunt.loadNpmTasks('grunt-contrib-watch');
  grunt.registerTask('default', ['less', 'transport', 'concat', 'uglify',
    'clean', 'jshint', 'connect', 'watch'
  ]);
};
